image: Visual Studio 2015

skip_branch_with_pr: true

environment:
  matrix:
    -  PYTHON: "C:\\Python36"
       PYQT5_VERSION: 5.11.2
       QT_BASE_PATH: c:\\Qt\\5.11.1

    -  PYTHON: "C:\\Python37-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.11.2
       QT_BASE_PATH: c:\\Qt\\5.11.1
       APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

    -  PYTHON: "C:\\Python37"
       PYQT5_VERSION: 5.11.2
       QT_BASE_PATH: c:\\Qt\\5.11.1

    -  PYTHON: "C:\\Python36-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.11.2
       QT_BASE_PATH: c:\\Qt\\5.11.1

    -  PYTHON: "C:\\python35-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.11.2
       QT_BASE_PATH: c:\\Qt\\5.11.1

    -  PYTHON: "C:\\python35"
       PYQT5_VERSION: 5.11.2
       QT_BASE_PATH: c:\\Qt\\5.11.1

    -  PYTHON: "C:\\Python37-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.10.1
       QT_BASE_PATH: c:\\Qt\\5.10.1
       APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

    -  PYTHON: "C:\\Python37"
       PYQT5_VERSION: 5.10.1
       QT_BASE_PATH: c:\\Qt\\5.10.1

    -  PYTHON: "C:\\Python36-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.10.1
       QT_BASE_PATH: c:\\Qt\\5.10.1

    -  PYTHON: "C:\\Python36"
       PYQT5_VERSION: 5.10.1
       QT_BASE_PATH: c:\\Qt\\5.10.1

    -  PYTHON: "C:\\python35-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.10.1
       QT_BASE_PATH: c:\\Qt\\5.10.1

    -  PYTHON: "C:\\python35"
       PYQT5_VERSION: 5.10.1
       QT_BASE_PATH: c:\\Qt\\5.10.1

    -  PYTHON: "C:\\Python37-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.9.2
       QT_BASE_PATH: c:\\Qt\\5.9.5
       APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

    -  PYTHON: "C:\\Python37"
       PYQT5_VERSION: 5.9.2
       QT_BASE_PATH: c:\\Qt\\5.9.5

    -  PYTHON: "C:\\Python36-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.9.2
       QT_BASE_PATH: c:\\Qt\\5.9.5

    -  PYTHON: "C:\\Python36"
       PYQT5_VERSION: 5.9.2
       QT_BASE_PATH: c:\\Qt\\5.9.5

    -  PYTHON: "C:\\python35-x64"
       PYTHON_SUFFIX: "-x64"
       PYQT5_VERSION: 5.9.2
       QT_BASE_PATH: c:\\Qt\\5.9.5

    -  PYTHON: "C:\\python35"
       PYQT5_VERSION: 5.9.2
       QT_BASE_PATH: c:\\Qt\\5.9.5



# https://www.appveyor.com/docs/how-to/rdp-to-build-worker/
init:
  - ps: if (Get-ChildItem Env:ENABLE_RDP -ErrorAction SilentlyContinue) {iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))} else {echo RDP not enabled}

build_script:
  - set PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%
  - "python -m pip freeze"
  # Build the compiled extension
  - "python stderr.py"
  - "pip install requests==2.13.0"
  - "pip install vcversioner==2.16.0.0"
  - "pip install wheel==0.30.0a0"
  - "pip install twine==1.11.0"
  - "pip install pytest==3.9.1"
  - "python -m pip freeze"
  - "python setup.py bdist_wheel"
  - ps: "python -m pip install --no-warn-script-location (get-item dist\\*.whl).FullName"
  - "python -m pytest pyqt5_tools.tests --pyargs"
  - "copy dist\\*.whl ."
  - "python twineontag.py"

artifacts:
  - path: '*.whl'

# https://www.appveyor.com/docs/how-to/rdp-to-build-worker/
on_finish:
  - ps: if (Get-ChildItem Env:ENABLE_RDP -ErrorAction SilentlyContinue) {$blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))} else {echo RDP not enabled}
